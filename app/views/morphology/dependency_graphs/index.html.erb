<%= render 'tools/header',
           name: 'Ayah Dependency Graphs',
           key: 'ayah_dependency_graph'
%>

<div class="page-wrapper tw-container tw-max-w-7xl tw-mx-auto tw-px-4">
  <div class="page-section filters">
    <%= form_tag morphology_dependency_graphs_path, method: :get do %>
      <div data-controller="chapter-verses-filter" class="tw-flex tw-flex-wrap">
        <%= render 'shared/filters' %>

        <div class="tw-mb-4 tw-me-4">
          <%= select_tag :review_status,
                         options_for_select([['All', ''], ['Approved', 'approved'], ['In progress', 'in_progress']], params[:review_status].to_s),
                         class: 'form-select tw-w-44' %>
          <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700">Status</label>
        </div>

        <div class="tw-mb-4 tw-me-4">
          <%= select_tag :with_graphs,
                         options_for_select([['All', '0'], ['Only with graphs', '1']], params[:with_graphs].to_s.presence || '0'),
                         class: 'form-select tw-w-44' %>
          <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700">With graphs</label>
        </div>

        <div class="tw-mb-4">
          <%= submit_tag 'Filter', class: 'btn btn-success', data: { disable_with: 'Please wait..' } %>
          <%= link_to 'Clear', morphology_dependency_graphs_path, class: 'btn-link text-dark' if has_filters?(:filter_chapter, :verse_number, :verse_key, :review_status, :with_graphs) %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="page-section tw-mt-4">
    <h2 class="tw-text-2xl tw-mb-4">Ayah list</h2>

    <div class="tools-table-overflow">
      <table class="tw-w-full hover:tw-bg-gray-50">
        <thead class="tw-sticky tw-top-0 tw-z-10 tw-bg-white tw-border-b-2 tw-border-black">
          <tr>
            <th>Key</th>
            <th>Ayah</th>
            <th>Graphs</th>
            <th>Review status</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <% @verses.each do |verse| %>
            <tr class="hover:tw-bg-gray-200 tw-border-b">
              <th scope="row" class="tw-py-2 tw-pl-2"><%= verse.verse_key %></th>
              <td class="tw-py-2">
                <div class="text-qpc-hafs tw-text-left">
                  <%= truncate verse.text_qpc_hafs, length: 70 %>
                </div>
              </td>
              <td class="tw-py-2"><%= verse.try(:graphs_count).to_i %></td>
              <td class="tw-py-2"><%= verse.try(:review_status_label).to_s.humanize %></td>
              <td class="tw-py-2">
                <% if verse.try(:graphs_count).to_i > 0 %>
                  <%= link_to 'View',
                              morphology_dependency_graph_path(verse.try(:first_graph_id)),
                              class: 'btn btn-success' %>
                <% else %>
                  <span class="btn btn-secondary disabled">View</span>
                <% end %>
              </td>
            </tr>
          <% end %>

          <tr>
            <td colspan="5">
              <div class="tw-flex tw-items-center">
                <div class="tw-me-4">
                  <%= pagy_bootstrap_nav(@pagy).html_safe %>
                </div>
                <div>
                  <%= pagy_info(@pagy).html_safe %>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

