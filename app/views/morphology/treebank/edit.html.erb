<%= render 'tools/header',
           name: 'Morphology Treebank',
           key: 'morphology_treebank',
           help: false
%>

<div class="page-wrapper container-lg">
  <div class="page-section">
    <div class="container-fluid mt-4">
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center bg-light p-3">
          <div class="d-flex align-items-center gap-3">
            <strong>Verse:</strong><%= @graph.verse_key %> (Graph <%= @graph.graph_number %>)
          </div>

          <h3 class="tw-text-xl mb-0">Edit Syntax Graph</h3>

          <div>
            <%= link_to 'Back to View', morphology_treebank_index_path(chapter_id: @chapter_id, verse_id: @verse_id, graph_number: @graph_number), class: 'btn btn-secondary btn-sm' %>
          </div>
        </div>

        <div class="card-body">
          <% if flash[:alert] %>
            <div class="alert alert-danger">
              <%= flash[:alert] %>
            </div>
          <% end %>

          <%= form_with url: edit_morphology_treebank_index_path(chapter_id: @chapter_id, verse_id: @verse_id, graph_number: @graph_number), method: :patch, local: true do |f| %>
            <%= hidden_field_tag :graph_id, @graph.id %>
            <%= render 'nodes_section',
                      graph_nodes: @graph_nodes,
                      node_types: @node_types,
                      available_words: @available_words,
                      available_edges: @available_edges,
                      available_segments: @available_segments,
                      graph_id: @graph.id %>

            <%= render 'edges_section',
                      graph_edges: @graph_edges,
                      available_nodes: @available_nodes,
                      edge_relations: @edge_relations %>

            <div class="d-flex gap-3 mt-4 p-3 bg-light rounded">
              <%= f.submit 'Save All Changes', class: 'btn btn-primary btn-lg', data: { confirm: 'Are you sure you want to update all nodes and edges?' } %>
              <%= link_to 'Cancel', morphology_treebank_index_path(chapter_id: @chapter_id, verse_id: @verse_id, graph_number: @graph_number), class: 'btn btn-secondary btn-lg' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
