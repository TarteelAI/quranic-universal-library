<%
  page_number = @mushaf_page.page_number
  pdf_page_offset = (@resource.meta_value('source-pdf-page-offset') || 1).to_i
  ayah_range_missing = @mushaf_page.first_verse_id.nil? || @mushaf_page.last_verse_id.nil?
  words_missing = @words.blank?
%>

<div class="page-wrapper tw-container tw-max-w-7xl tw-mx-auto tw-px-4">
  <% if ayah_range_missing %>
    <div class="tw-max-w-2xl tw-mx-auto tw-mt-8">
      <div class="tw-bg-blue-50 tw-border-l-4 tw-border-blue-500 tw-p-6 tw-rounded-lg">
        <div class="tw-flex tw-items-start">
          <div class="tw-flex-shrink-0">
            <svg class="tw-h-8 tw-w-8 tw-text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="tw-ml-4 tw-flex-1">
            <h3 class="tw-text-lg tw-font-semibold tw-text-blue-900 tw-mb-2">
              Ayah Range Required
            </h3>
            <p class="tw-text-blue-800 tw-mb-4">
              Before you can align lines for page <%= page_number %>, you need to set the Ayah range first. This defines which verses appear on this page.
            </p>
            <div class="tw-flex tw-gap-3">
              <%= link_to mushaf_layout_path(@mushaf.id, page_number: page_number, view_type: 'page_mapping'), class: 'btn btn-primary', data: { turbo_frame: 'page' } do %>
                <span>Set Ayah Range</span>
              <% end %>
              <%= link_to 'Back to Pages', mushaf_layout_path(@mushaf.id), class: 'btn btn-secondary', data: { turbo_frame: '_top' } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% elsif words_missing %>
    <div class="tw-max-w-2xl tw-mx-auto tw-mt-8">
      <div class="tw-bg-orange-50 tw-border-l-4 tw-border-orange-500 tw-p-6 tw-rounded-lg">
        <div class="tw-flex tw-items-start">
          <div class="tw-flex-shrink-0">
            <svg class="tw-h-8 tw-w-8 tw-text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <div class="tw-ml-4 tw-flex-1">
            <h3 class="tw-text-lg tw-font-semibold tw-text-orange-900 tw-mb-2">
              Word Mapping Required
            </h3>
            <p class="tw-text-orange-800 tw-mb-4">
              Before you can align lines for page <%= page_number %>, you need to map the words first. This defines the word placement on this page.
            </p>
            <div class="tw-flex tw-gap-3">
              <%= link_to edit_mushaf_layout_path(@mushaf.id, page_number: page_number), class: 'btn btn-primary', data: { turbo_frame: '_top' } do %>
                <span>Map Words</span>
              <% end %>
              <%= link_to 'Back to Pages', mushaf_layout_path(@mushaf.id), class: 'btn btn-secondary', data: { turbo_frame: '_top' } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <div class="mushaf-wrapper">
      <%= render SplitScreenComponent.new do |component| %>
        <%= component.with_left do %>
          <%= render 'shared/pdf_or_archive_embed', jump_to_page: page_number + pdf_page_offset %>
        <% end %>

        <%= component.with_right do %>
          <%= turbo_frame_tag "mushaf-page" do %>
            <div
              data-page="<%= page_number %>"
              data-controller="update-mushaf-page"
              class="tw-flex tw-justify-between <%= @mushaf.default_font_name %>">
              <%= render 'line_alignment' %>

              <div class="page-section tw-p-3">
                <%= render 'shared/mushaf_page', words: @words, page: page_number, mushaf: @mushaf, name: @resource.name %>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>

