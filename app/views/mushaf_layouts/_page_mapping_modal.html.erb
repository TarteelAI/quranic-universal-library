<div id="title" class="tw-hidden">Set Ayah Range for Page <%= params[:page_number] %></div>
<div id="body">
  <%
    pdf_page_offset = (@resource.meta_value('source-pdf-page-offset') || 2).to_i
    page_number_for_pdf = @mushaf_page.page_number.to_i + pdf_page_offset
    page = @mushaf_page
  %>
  
  <% if page %>
    <%
      first_ayah_key = Utils::Quran.get_ayah_key_from_id(page.first_verse_id)
      last_ayah_key = Utils::Quran.get_ayah_key_from_id(page.last_verse_id)
    %>
    
    <%= render SplitScreenComponent.new do |component| %>
      <%= component.with_left do %>
        <%= render 'shared/pdf_or_archive_embed', jump_to_page: page_number_for_pdf, page_offset: pdf_page_offset %>
      <% end %>

      <%= component.with_right do %>
        <div class="tw-p-4">
          <h4 class="tw-text-lg tw-font-semibold tw-mb-3">Page <%= page.page_number %> - Ayah Range</h4>
          
          <div class="tw-mb-4">
            <p class="tw-text-sm tw-text-gray-600 tw-mb-3">
              Ayah key format is <code>surah:ayah</code>
              <br/>
              For example: <code>1:1</code> refers to the first verse of the first surah, <code>2:255</code> refers to verse 255 of surah 2.
            </p>
          </div>

          <%= form_with model: page, url: save_page_mapping_mushaf_layout_path(@mushaf, page_number: page.page_number), method: :put, html: { class: 'mushaf-pages' } do |form| %>
            <div class="tw-space-y-4">
              <div>
                <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-2">First Ayah</label>
                <div id="<%= page.page_number %>-from">
                  <%= form.text_field :first_verse_id, value: first_ayah_key, class: 'from form-control', placeholder: 'From (e.g., 1:1)', required: true, disabled: !@access %>
                  <div class="tw-text-sm tw-text-gray-600 tw-mt-1">
                    Current: <%= first_ayah_key || 'Not set' %>
                  </div>
                </div>
              </div>
              
              <div>
                <label class="tw-block tw-text-sm tw-font-medium tw-text-gray-700 tw-mb-2">Last Ayah</label>
                <div id="<%= page.page_number %>-to">
                  <%= form.text_field :last_verse_id, value: last_ayah_key, class: 'to form-control', placeholder: 'To (e.g., 1:7)', required: true, disabled: !@access %>
                  <div class="tw-text-sm tw-text-gray-600 tw-mt-1">
                    Current: <%= last_ayah_key || 'Not set' %>
                  </div>
                </div>
              </div>
              
              <div class="tw-flex tw-gap-2 tw-justify-end tw-pt-3">
                <%= form.submit 'Save', id: 'submit', class: 'btn btn-primary', disabled: !@access, data: { bs_dismiss: 'modal' } %>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <p class="tw-text-red-600">Page not found</p>
  <% end %>
</div>

