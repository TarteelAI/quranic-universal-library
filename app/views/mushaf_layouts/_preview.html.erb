<% page_number = @mushaf_page.page_number %>

<% if @compare_mushaf_words || params[:source_pdf] == 'true' %>
  <div class="page-wrapper container-lg">
    <div class="mushaf-wrapper resize-container" data-controller="resizeable">
      <div class="resizable" id="left-side">
        <% if @compare_mushaf_words %>
          <div class="mushaf-layout <%= @compared_mushaf.default_font_name %>">
            <%= render 'shared/mushaf_page', words: @compare_mushaf_words, page: page_number, mushaf: @compared_mushaf, name: @compared_mushaf.name, page_class: 'bg-warning-50' %>
          </div>
        <% else %>
          <%
            pdf_page_offset = (@resource.meta_value('source-pdf-page-offset') || 1).to_i
            pdf_url = @resource.get_source_pdf_url
          %>

          <% if pdf_url.present? %>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
          <% end %>

          <div class="pdf-viewer"
               data-controller="pdf-viewer"
               data-page="<%= @mushaf_page.page_number.to_i + pdf_page_offset %>"
               data-page-offset="<%= pdf_page_offset %>"
               data-pdf-url="<%= pdf_url %>">
            <div id="pdf-wrapper">
              <div id="pdf-container">
                <canvas id="pdf-canvas"></canvas>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <div class="handler"></div>
      <div class="mushaf-layout resizable <%= @mushaf.default_font_name %>" id="right-side">
        <%= render 'shared/mushaf_page', words: @words, page: page_number, mushaf: @mushaf, name: @resource.name %>
      </div>
    </div>
  </div>
<% else %>
  <div class="page-wrapper container-lg">
    <div class="mushaf-wrapper">
      <div class="mushaf-layout <%= @mushaf.default_font_name %>">
        <%= render 'shared/mushaf_page', words: @words, page: page_number, mushaf: @mushaf, name: @resource.name %>
      </div>
    </div>
  </div>
<% end %>
