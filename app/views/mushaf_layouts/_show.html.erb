<%= render 'tools/header',
           name: @mushaf.name,
           key: 'mushaf_layouts',
           help: 'mushaf_layout',
           actions: [
             link_to('Back to mushaf list', mushaf_layouts_path, class: 'btn btn-info')
           ]
%>

<%= render 'shared/access_message' %>

<%= turbo_frame_tag 'resources' do %>
  <div class="page-wrapper tw-container tw-max-w-7xl tw-mx-auto tw-px-4">
    <div class="page-section">
      <div class="tw-mb-6">
        <div class="tw-bg-blue-50 tw-border tw-border-blue-200 tw-rounded-lg tw-p-4 tw-tw-mb-4">
          <p class="tw-text-sm tw-text-gray-700 tw-tw-mb-2">
            This mushaf has <strong><%= @mushaf.pages_count %></strong> pages,
            <strong><%= @mushaf.lines_per_page %></strong> lines per page.
            <span class="tw-font-semibold">Workflow for each page is:</span>
          </p>

          <div class="tw-flex tw-items-center tw-gap-2 tw-text-sm tw-text-gray-600 tw-flex-wrap">
            <span class="tw-font-medium">Step 1: Set Ayah Range</span>
            <span class="tw-text-blue-500">→</span>
            <span class="tw-font-medium">Step 2: Assign Line Numbers</span>
            <span class="tw-text-blue-500">→</span>
            <span class="tw-font-medium">Step 3: Fix Line Alignment</span>
            <span class="tw-text-blue-500">→</span>
            <span class="tw-font-medium">Step 4: Preview</span>
          </div>
        </div>

        <p class="tw-text-gray-600 tw-text-base">
          Table below is showing all the pages with their current status.
        </p>
      </div>
      <div class="tw-sticky tw-top-0 tw-z-20 tw-bg-white tw-pb-4 tw-tw-mb-4 tw-border-b tw-border-gray-200">
        <%= form_with url: mushaf_layout_path(@mushaf.id), method: :get do |f| %>
          <div class="tw-flex tw-gap-2">
            <%= f.search_field :search,
                               value: params[:search],
                               placeholder: "Search by page number or ayah (e.g., 20 or 2:5)...",
                               class: "form-control tw-flex-1 tw-px-4 tw-py-2 tw-border tw-border-gray-300 tw-rounded-lg focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-blue-500" %>
            <%= f.hidden_field :sort_key, value: params[:sort_key] %>
            <%= f.hidden_field :sort_order, value: params[:sort_order] %>
            <%= f.submit 'Search', class: 'tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-rounded tw-transition-colors' %>

            <% if params[:search].present? %>
              <%= link_to 'Clear', mushaf_layout_path(@mushaf.id, sort_key: params[:sort_key], sort_order: params[:sort_order]), class: 'tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-gray-500 hover:tw-bg-gray-600 tw-text-white tw-rounded tw-transition-colors', data: { turbo_frame: 'pages_table' } %>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="tools-table-overflow">
        <table class="tw-w-full hover:tw-bg-gray-50">
          <thead class="tw-sticky tw-z-10 tw-bg-white tw-border-b-2 tw-border-black" style="top: 42px;">
          <tr>
            <th class="tw-py-3 tw-px-4 tw-tw-text-left">
              <%= sort_order_link 'Page #', :page_number %>
            </th>
            <th class="tw-py-3 tw-px-4 tw-tw-text-left">Ayah Range</th>
            <th class="tw-py-3 tw-px-4 tw-tw-text-left">Status</th>
            <th class="tw-py-3 tw-px-4 tw-tw-text-left">Actions</th>
          </tr>
          </thead>

          <tbody>
            <%= render partial: 'page_row', collection: @pages, as: :page %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>
