<div class="tw-mb-6">
  <div class="tw-space-y-8 tw-p-6 tw-bg-gray-50 tw-rounded-2xl tw-shadow-md">
    <h2 class="tw-text-2xl tw-font-bold tw-text-gray-800">Explore Quranic Topics</h2>
    <p class="tw-text-gray-600 tw-text-base">
      Browse all Quranic topics organized by <span class="tw-font-semibold">Ontology</span>,
      <span class="tw-font-semibold">Thematic</span>, and <span class="tw-font-semibold">General</span> categories.
      Click on any topic to see associated ayahs.
    </p>

    <div>
      <h3 class="tw-text-xl tw-font-semibold tw-text-indigo-700">Ontology Topics</h3>
      <p class="tw-text-gray-700 tw-mt-2">
        The <span class="tw-font-semibold">Quranic Ontology</span> uses knowledge representation
        to define key concepts in the Quran and show their relationships using predicate logic.
        The ontology is based on traditional Quranic analysis, including the
        <em>hadīth</em> of the Prophet Muhammad ﷺ and the <em>tafsīr</em> of Ibn Kathīr.
        Named entities in verses, such as historic people and places, are linked to concepts
        in the ontology through named entity tagging.
      </p>
      <p class="tw-text-gray-700 tw-mt-2">
        The ontology is a graph of <span class="tw-font-semibold">300 linked concepts</span>
        and <span class="tw-font-semibold">350 relations</span>, providing a structured map of Quranic knowledge.
        Ontology topics are sourced from <a href="https://corpus.quran.com/ontology.jsp" class="tw-text-blue-600 tw-underline" target="_blank" rel="noopener noreferrer">Quran corpus project</a>.
      </p>
    </div>

    <div>
      <h3 class="tw-text-xl tw-font-semibold tw-text-green-700">Thematic Topics</h3>
      <p class="tw-text-gray-700 tw-mt-2">
        Thematic topics are grouped into three major themes, each highlighting
        a different dimension of Quranic teachings:
      </p>
      <ul class="tw-list-disc tw-pl-6 tw-mt-3 tw-space-y-2 tw-text-gray-700">
        <li>
          <span class="tw-font-semibold">۩ Doctrine</span> — Focuses on a Muslim’s relationship
          with Allah, with others, and with creation. Includes acts of worship, family relations,
          business transactions, and moral interactions.
        </li>
        <li>
          <span class="tw-font-semibold">⌛ Stories</span> — Narratives such as those of Moses, Noah,
          and Ṣâliḥ, which reassured the Prophet ﷺ during rejection in Mecca and served as warnings
          for disbelievers (see 11:120–123). Other stories, like Joseph and Job, emphasize
          moral lessons.
        </li>
        <li>
          <span class="tw-font-semibold">☼ The Unseen</span> — Belief in Allah’s qualities, angels,
          resurrection, and judgment. These reinforce faith in the divine through the heart,
          beyond physical perception.
        </li>
      </ul>
      Thematic topics are sourced from <a href="https://theclearquran.org/" class="tw-text-blue-600 tw-underline" target="_blank" rel="noopener noreferrer">Clear Quran translation</a>.
    </div>

    <div>
      <h3 class="tw-text-xl tw-font-semibold tw-text-blue-700">General Topics</h3>
      <p class="tw-text-gray-700 tw-mt-2">
        <span class="tw-font-semibold">General topics</span> cover a wide range of Quranic subjects
        that don’t fall directly under Ontology or Thematic categories. These provide an accessible
        entry point for readers to explore various aspects of the Quran.
      </p>
    </div>
  </div>
</div>

<%= render 'resources/previews/ayah_topics/search_box', resource: resource, search_query: @search_query, searched_verse: @searched_verse, is_verse_search: @is_verse_search, total_topics: @pagy.count %>

<!-- Topics Table -->
<div class="tw-overflow-x-auto tw-mb-6">
  <table class="tw-min-w-full tw-bg-white tw-border tw-border-gray-200 tw-rounded-lg tw-shadow-sm">
    <thead class="tw-bg-gray-50 tw-border-b tw-border-gray-200">
      <tr>
        <th class="tw-px-4 tw-py-3 tw-text-left tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider">
          <%= sortable_column_header('Topic Name', 'name', resource, @sort_by, @sort_direction, @search_query) %>
        </th>
        <th class="tw-px-4 tw-py-3 tw-text-left tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider tw-hidden md:tw-table-cell">
          Arabic Name
        </th>
        <th class="tw-px-4 tw-py-3 tw-text-center tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider">
          Type
        </th>
        <th class="tw-px-4 tw-py-3 tw-text-left tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider tw-hidden lg:tw-table-cell">
          Parent
        </th>
        <th class="tw-px-4 tw-py-3 tw-text-center tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider tw-hidden lg:tw-table-cell">
          Children
        </th>
        <th class="tw-px-4 tw-py-3 tw-text-center tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider">
          <%= sortable_column_header('Ayahs', 'ayahs_count', resource, @sort_by, @sort_direction, @search_query, extra_classes: 'tw-justify-center') %>
        </th>
        <th class="tw-px-4 tw-py-3 tw-text-center tw-text-xs tw-font-semibold tw-text-gray-700 tw-uppercase tw-tracking-wider">
          Action
        </th>
      </tr>
    </thead>
    <tbody class="tw-divide-y tw-divide-gray-200">
      <% @topics.each do |topic| %>
        <%= render 'resources/previews/ayah_topics/topic_row', topic: topic, resource: resource %>
      <% end %>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<% if @pagy.pages > 1 %>
  <div class="tw-flex tw-justify-center tw-mt-6">
    <% 
      # Build pagination URLs with preserved search and sort params
      pagy_url_proc = proc do |page_num|
        detail_resources_path('ayah-topics', resource.id, 
                              page: page_num, 
                              search: @search_query,
                              sort_by: @sort_by,
                              sort_direction: @sort_direction)
      end
    %>
    <%== pagy_bootstrap_nav(@pagy, pagy_id: 'topics-pagination', link_extra: '', pagy_url: pagy_url_proc).html_safe %>
  </div>
<% end %>

