<%
  surah, group_start_ayah = @tafisr.group_verse_key_from.split(':').map(&:to_i)
  _, group_end_ayah = @tafisr.group_verse_key_to.split(':').map(&:to_i)

  actions = []
  more_action = []
  verse = if params[:verse_key].present?
            Verse.find_by(verse_key: params[:verse_key].downcase)
          end
  verse ||= Verse.find_by(verse_key: "#{surah}:#{group_start_ayah}")
  next_ayah = verse.next_ayah
  previous_ayah = verse.previous_ayah

  view_type = params[:view_type].presence || 'ayah'
  if !tafisr_view_types.include?(view_type)
    view_type = 'ayah'
  end
  more_action << link_to('Tafsir view', tafsir_proofreading_path(@tafisr.id, resource_id: @resource.id), class: 'tw-block tw-px-4 tw-py-2 tw-text-sm tw-text-gray-700 hover:tw-bg-gray-100')
  more_action << link_to('Tafsir with arabic view', tafsir_proofreading_path(@tafisr.id, resource_id: @resource.id, view_type: 'page_with_arabic'), class: 'tw-block tw-px-4 tw-py-2 tw-text-sm tw-text-gray-700 hover:tw-bg-gray-100')
  more_action << link_to('Proofreading view(With pdf)', tafsir_proofreading_path(@tafisr.id, resource_id: @resource.id, view_type: 'page_with_pdf'), class: 'tw-block tw-px-4 tw-py-2 tw-text-sm tw-text-gray-700 hover:tw-bg-gray-100')

  if @access
    actions << link_to('Edit', edit_tafsir_proofreading_path(@tafisr.id, resource_id: @resource.id), class: 'tw-h-10 tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-rounded tw-transition-colors tw-flex tw-items-center')
  end

  actions << %Q{
    <div class='tw-relative' data-controller='dropdown'>
      <button class='tw-h-10 tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-rounded tw-transition-colors tw-flex tw-items-center tw-gap-2' type='button' data-action='click->dropdown#toggle' aria-expanded='false'>
        Change view
        <svg class='tw-w-4 tw-h-4' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
          <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'></path>
        </svg>
      </button>
      <ul class='tw-absolute tw-right-0 tw-mt-2 tw-w-56 tw-rounded-md tw-shadow-lg tw-bg-white tw-ring-1 tw-ring-black tw-ring-opacity-5 tw-z-50 tw-hidden' data-dropdown-target='menu'>
        #{more_action.map { |action| "<li>#{action}</li>" }.join('')}
      </ul>
    </div>
  }

  if previous_ayah
    actions << link_to('Previous ayah', tafsir_proofreading_path(@tafisr.id, resource_id: @resource.id, draft: params[:draft], verse_key: previous_ayah.verse_key), class: 'tw-h-10 tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-gray-800 hover:tw-bg-gray-900 tw-text-white tw-rounded tw-transition-colors tw-flex tw-items-center')
  end

  if next_ayah
    actions << link_to('Next ayah', tafsir_proofreading_path(@tafisr.id, resource_id: @resource.id, draft: params[:draft], verse_key: next_ayah.verse_key), class: 'tw-h-10 tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-gray-800 hover:tw-bg-gray-900 tw-text-white tw-rounded tw-transition-colors tw-flex tw-items-center')
  end

  actions << link_to('Back to filter', tafsir_proofreadings_path(resource_id: @resource.id), class: 'tw-h-10 tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-white tw-border tw-border-blue-600 tw-text-blue-600 hover:tw-bg-blue-600 hover:tw-text-white tw-rounded tw-transition-colors tw-flex tw-items-center')
%>

<%= render 'tools/header',
           name: "Ayah tafsir",
           title: "#{@resource.name} <div style='font-size: 0.5em'>#{@tafisr.group_verse_key_from} - #{@tafisr.group_verse_key_to}</div>",
           key: 'ayah_tafsir',
           actions: actions
%>

<div class="page-wrapper tw-container tw-max-w-7xl tw-mx-auto tw-px-4">
  <div class="page-section">
    <%= render "#{view_type}_view", verse: verse %>
  </div>
</div>