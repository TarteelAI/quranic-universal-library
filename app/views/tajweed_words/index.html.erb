<%= render 'tools/header',
           name: "Tajweed",
           title: "Tajweed rules tool",
           key: 'tajweed'
%>

<div class="page-wrapper tw-container tw-max-w-7xl tw-mx-auto tw-px-4">
  <div class="page-section filters">
    <%= form_tag tajweed_words_path, method: :get, class: 'tw-flex' do %>
      <div class="tw-flex tw-flex-wrap tw-gap-4" data-controller="chapter-verses-filter">
        <div class="tw-flex tw-flex-col sm:tw-flex-row tw-flex-wrap tw-space-y-4 sm:tw-space-y-0">
          <% if false %>
            <div class="tw-mb-4 tw-me-2">
              <%= select_tag :filter_tajweed_rule_old, options_for_select(tajweed_rule_options_for_select(TajweedRules.new, display: 'name'), params[:filter_tajweed_rule_old]), include_blank: true, class: 'form-select tw-w-[100%]', data: { placeholder: 'Filter by tajweed rule(old)', controller: 'select2' } %>
              <p class="tw-text-sm tw-text-gray-600 tw-mt-1">Filter by Tajweed rule(old)</p>
            </div>
          <% end %>
          <div class="tw-mb-4 tw-me-2">
            <%= select_tag :filter_tajweed_rule_new, options_for_select(tajweed_rule_options_for_select(TajweedRules.new('new'), display: 'name'), params[:filter_tajweed_rule_new]), include_blank: true, class: 'form-select tw-w-[100%] tw-border-gray-400 tw-rounded-[5px]', data: { placeholder: 'Filter by tajweed rule(new)', controller: 'select2' } %>
            <p class="tw-text-sm tw-text-gray-600 tw-mt-1">Filter by Tajweed rule</p>
          </div>

          <div class="tw-mb-4 tw-me-2">
            <%= text_field_tag :filter_text, params[:filter_text], class: 'form-control tw-border-gray-400 tw-rounded-[5px] tw-h-[38px]' %>
            <p class="tw-text-sm tw-text-gray-600 tw-mt-1">Filter by text</p>
          </div>

          <div class="tw-mb-4 tw-me-2">
            <div class="tw-flex tw-space-y-4 sm:tw-space-y-0 tw-flex-col sm:tw-flex-row">
              <%= text_field_tag :filter_regexp_start, params[:filter_regexp_start], placeholder: 'Start with', class: 'form-control me-2  tw-w-[100%] sm:tw-w-auto tw-border-gray-400 tw-rounded-[5px] tw-h-[38px]'%>
              <%= text_field_tag :filter_regexp_end, params[:filter_regexp_end], placeholder: 'Ends with', class: 'form-control me-2 tw-w-[100%] sm:tw-w-auto tw-border-gray-400 tw-rounded-[5px] tw-h-[38px]'%>
              <label for="filter_word_boundary">
                <%= check_box_tag :filter_word_boundary, '1', params[:filter_word_boundary] == '1' %>
                Filter whole word
              </label>
            </div>
            <p class="tw-text-sm tw-text-gray-600 tw-mt-1 tw-mb-4 sm:tw-mb-0">Filter by Regexp(Find word that start and ends with specific letter)</p>
          </div>
        </div>

        <div class="tw-flex tw-space-y-4 sm:tw-space-y-0 tw-flex-col sm:tw-flex-row tw-w-[100%]">
          <%= render 'shared/filters', page: true %>

          <div class="tw-mb-4 ms-auto">
            <%= submit_tag 'Filter', class: 'tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-rounded tw-transition-colors', data: { disable_with: 'Please wait..' } %>
            <%= link_to 'Clear', tajweed_words_path, class: 'tw-text-gray-900 hover:tw-text-gray-700 hover:tw-underline' if has_filters?(:filter_page, :filter_chapter, :filter_verse, :filter_text, :filter_tajweed_rule) %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="page-section tw-mt-4">
    <h2 class="tw-text-2xl tw-mb-4">Words</h2>
    <div class= "tools-table-overflow">
    <table class="tw-w-full hover:tw-bg-gray-50">
      <thead class="tw-sticky tw-top-0 tw-z-10 tw-bg-white tw-border-b-2 tw-border-black">
      <tr>
        <th><%= sort_order_link 'Word index', :word_index %></th>
        <th>Location</th>
        <th>QPC Hafs</th>
        <th class="tw-truncate tw-whitespace-nowrap">Digital Khatt</th>
        <th>Text(old)</th>
        <th>Text(new)</th>
        <th class="tw-truncate tw-whitespace-nowrap">V4 Tajweed Img</th>
        <th class="tw-truncate tw-whitespace-nowrap">RQ Tajweed Img</th>
        <th>Actions</th>
      </tr>
      </thead>

      <tbody>
      <% @words.each do |word| %>
        <tr class="hover:tw-bg-gray-200 tw-border-b">
          <td class="tw-py-2 tw-pl-2">
            <%= link_to word.word_index, tajweed_word_path(word.location) %>
          </td>

          <td class="tw-py-2 tw-text-left">
            <%= word.location %>
          </td>
          <td class="tw-py-2 qpc-hafs">
            <%= word.text_qpc_hafs %>
          </td>
          <td class="tw-py-2 digitalkhatt">
            <%= word.text_digital_khatt %>
          </td>

          <td class="tw-py-2 qpc-hafs" data-controller="tajweed-highlight">
            <%= safe_html word.text_uthmani_tajweed %>
          </td>

          <td class="tw-py-2 qpc-hafs tajweed-new" data-controller="tajweed-highlight">
            <%= safe_html word.text_qpc_hafs_tajweed %>
          </td>

          <td class="tw-py-2" style="text-align: right">
            <%= image_tag word.tajweed_v4_image_url, style: 'max-height: 70px' %>
          </td>

          <td class="tw-py-2" style="text-align: right">
            <% s, a, w = word.location.split(':') %>
            <%= link_to "https://recitequran.com/#{s}:#{a}/w#{w}", target: '_blank' do %>
              <%= image_tag word.rq_tajweed_image_url, style: 'max-height: 70px' %>
            <% end %>
          </td>

          <td class="tw-py-2 tw-text-right">
            <div class="tw-flex tw-gap-1">
              <%= link_to 'Show', tajweed_word_path(word.location), class: 'tw-px-4 tw-py-2 tw-text-sm tw-font-medium tw-bg-green-600 hover:tw-bg-green-700 tw-text-white tw-rounded tw-transition-colors' %>
            </div>
          </td>
        </tr>
      <% end %>

      <tr>
        <td colspan="7">
          <div class="tw-flex tw-items-center">
            <div class="tw-me-4">
              <%= safe_html pagy_nav_tailwind(@pagy) %>
            </div>
            <div>
              <%= safe_html pagy_info(@pagy) %>
            </div>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</div>


