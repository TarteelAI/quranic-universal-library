<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Audio Comparison Tool</title>
    <script type="module">
      import WaveSurfer from 'https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.8.14/wavesurfer.esm.min.js';
      import Timeline from 'https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.8.14/plugins/timeline.esm.min.js';
      import Regions from 'https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.8.14/plugins/regions.esm.min.js';
      import Hover from 'https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.8.14/plugins/hover.esm.min.js';
      import Zoom from 'https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.8.14/plugins/zoom.esm.min.js';
     // import Spectrogram from 'https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/7.8.14/plugins/spectrogram.esm.js'

      // Wait for the DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', () => {
        const loadFile = (file, input) => {
        }

        const registerDropzone =  (dropZone, audioId) => {
          const audioField = dropZone.querySelector('input[type="file"]');
          dropZone.addEventListener('click', () => {
            audioField.click();
          });

          dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('highlight');
          });

          dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('highlight');
          });

          dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('highlight');
            const files = e.dataTransfer.files;

            loadAudio(audioId == 1 ? wavesurfer1 : wavesurfer2, files[0], `stats${audioId}`);
          });
        }

        const audio1Regions = Regions.create()
        const audio2Regions = Regions.create()

        // Initialize WaveSurfer instances for both audio files
        const wavesurfer1 = WaveSurfer.create({
          container: '#waveform1',
          waveColor: 'blue',
          progressColor: 'purple',
          scrollParent: true,
          dragToSeek: true,
          plugins: [
            Timeline.create(),
            Hover.create(),
            Zoom.create(),
            audio1Regions
               ]
        });

        const wavesurfer2 = WaveSurfer.create({
          container: '#waveform2',
          waveColor: 'green',
          progressColor: 'orange',
          scrollParent: true,
          dragToSeek: true,
          plugins: [
            Timeline.create(),
            Hover.create(),
            Zoom.create(),
            audio2Regions
          ]
        });

        // Add time update listeners for both waveforms
        wavesurfer1.on('timeupdate', (currentTime) => {
          updateTimeDisplay('time1', currentTime);
        });

        wavesurfer2.on('timeupdate', (currentTime) => {
          updateTimeDisplay('time2', currentTime);
        });

        // Function to update time display
        function updateTimeDisplay(elementId, currentTime) {
          const seconds = Math.floor(currentTime);
          const milliseconds = Math.floor((currentTime % 1) * 1000);
          const timeElement = document.getElementById(elementId);
          if (timeElement) {
            timeElement.textContent = `${seconds}s ${milliseconds}ms`;
          }
        }

        // Region management variables
        let selectedRegion1 = null;
        let selectedRegion2 = null;
        let isPlayingRegion1 = false;
        let isPlayingRegion2 = false;

        // Function to create a region
        function createRegion(wavesurfer, color, id, regionsPlugin) {
          const region = regionsPlugin.addRegion({
            start: 0,
            end: 10,
            color: color,
            drag: true,
            resize: true,
            id: id
          });

          // Store region reference
          if (id === 'region1') {
            selectedRegion1 = region;
          } else {
            selectedRegion2 = region;
          }

          // Update region info display
          updateRegionInfo(id, region.start, region.end);

          return region;
        }

        // Function to update region info display
        function updateRegionInfo(regionId, start, end) {
          const infoElement = document.getElementById(`${regionId}Info`);
          if (infoElement) {
            const duration = (end - start).toFixed(2);
            infoElement.innerHTML = `
              <strong>Region:</strong> ${start.toFixed(2)}s - ${end.toFixed(2)}s (Duration: ${duration}s)
            `;
          }
        }

        // Function to play selected region
        function playRegion(wavesurfer, region, regionId) {
          if (!region) {
            alert('Please select a region first by dragging on the waveform');
            return;
          }

          // Stop current playback
          wavesurfer.pause();
          
          // Set the region bounds
          const start = region.start;
          const end = region.end;
          
          // Seek to start of region
          wavesurfer.setTime(start);
          
          // Play the region
          wavesurfer.play();
          
          // Set flag
          if (regionId === 'region1') {
            isPlayingRegion1 = true;
          } else {
            isPlayingRegion2 = true;
          }

          // Stop at end of region
          const checkEnd = () => {
            if (wavesurfer.getCurrentTime() >= end) {
              wavesurfer.pause();
              if (regionId === 'region1') {
                isPlayingRegion1 = false;
              } else {
                isPlayingRegion2 = false;
              }
            } else if (isPlayingRegion1 || isPlayingRegion2) {
              requestAnimationFrame(checkEnd);
            }
          };
          
          requestAnimationFrame(checkEnd);
        }

        // Function to clear region
        function clearRegion(wavesurfer, regionId) {
          if (regionId === 'region1' && selectedRegion1) {
            wavesurfer.plugins.regions.removeRegion(selectedRegion1);
            selectedRegion1 = null;
            document.getElementById('region1Info').innerHTML = '<em>No region selected</em>';
          } else if (regionId === 'region2' && selectedRegion2) {
            wavesurfer.plugins.regions.removeRegion(selectedRegion2);
            selectedRegion2 = null;
            document.getElementById('region2Info').innerHTML = '<em>No region selected</em>';
          }
        }

        // Function to detect and highlight silences
        async function detectSilences(wavesurfer, regionsPlugin, audioNumber) {
          try {
            // Get the audio buffer data
            const audioContext = new AudioContext();
            const audioElement = wavesurfer.media;
            
            if (!audioElement.src) {
              alert('Please load an audio file first');
              return;
            }

            // Get sensitivity values from UI
            const thresholdSlider = document.getElementById(`silenceThreshold${audioNumber}`);
            const durationSlider = document.getElementById(`minSilenceDuration${audioNumber}`);
            
            const silenceThreshold = thresholdSlider ? parseFloat(thresholdSlider.value) / 100 : 0.01;
            const minSilenceDuration = durationSlider ? parseFloat(durationSlider.value) : 0.1;
            
            // Clear existing silence regions
            const existingRegions = regionsPlugin.getRegions();
            existingRegions.forEach(region => {
              if (region.id && region.id.startsWith(`silence_${audioNumber}`)) {
                regionsPlugin.removeRegion(region);
              }
            });

            // Create a temporary audio context to analyze the file
            const tempContext = new AudioContext();
            const response = await fetch(audioElement.src);
            const arrayBuffer = await response.arrayBuffer();
            const audioBuffer = await tempContext.decodeAudioData(arrayBuffer);
            
            const channelData = audioBuffer.getChannelData(0); // Use first channel
            const sampleRate = audioBuffer.sampleRate;
            const duration = audioBuffer.duration;
            
            // Parameters for silence detection
            const windowSize = Math.floor(sampleRate * 0.01); // 10ms window
            
            const silences = [];
            let inSilence = false;
            let silenceStart = 0;
            
            // Analyze audio in windows
            for (let i = 0; i < channelData.length; i += windowSize) {
              const windowEnd = Math.min(i + windowSize, channelData.length);
              let maxAmplitude = 0;
              
              // Find max amplitude in this window
              for (let j = i; j < windowEnd; j++) {
                maxAmplitude = Math.max(maxAmplitude, Math.abs(channelData[j]));
              }
              
              const currentTime = i / sampleRate;
              
              if (maxAmplitude < silenceThreshold && !inSilence) {
                // Start of silence
                inSilence = true;
                silenceStart = currentTime;
              } else if (maxAmplitude >= silenceThreshold && inSilence) {
                // End of silence
                const silenceEnd = currentTime;
                const silenceDuration = silenceEnd - silenceStart;
                
                if (silenceDuration >= minSilenceDuration) {
                  silences.push({
                    start: silenceStart,
                    end: silenceEnd,
                    duration: silenceDuration
                  });
                }
                inSilence = false;
              }
            }
            
            // Handle case where audio ends in silence
            if (inSilence) {
              const silenceDuration = duration - silenceStart;
              if (silenceDuration >= minSilenceDuration) {
                silences.push({
                  start: silenceStart,
                  end: duration,
                  duration: silenceDuration
                });
              }
            }
            
            // Create regions for detected silences
            silences.forEach((silence, index) => {
              const region = regionsPlugin.addRegion({
                start: silence.start,
                end: silence.end,
                color: 'rgba(0, 0, 255, 0.3)', // Blue for silences
                id: `silence_${audioNumber}_${index}`,
                drag: false,
                resize: false
              });
              
              // Add tooltip with silence info
              region.element.title = `Silence: ${silence.duration.toFixed(2)}s (${silence.start.toFixed(2)}s - ${silence.end.toFixed(2)}s)`;
            });
            
            // Update silence info display
            const silenceInfoElement = document.getElementById(`silenceInfo${audioNumber}`);
            if (silenceInfoElement) {
              if (silences.length > 0) {
                const totalSilence = silences.reduce((sum, s) => sum + s.duration, 0);
                const silencePercentage = ((totalSilence / duration) * 100).toFixed(1);
                silenceInfoElement.innerHTML = `
                  <strong>Detected ${silences.length} silence(s):</strong><br>
                  Total silence: ${totalSilence.toFixed(2)}s (${silencePercentage}%)<br>
                  <small class="text-gray-600">Blue regions highlight detected silences</small>
                `;
              } else {
                silenceInfoElement.innerHTML = '<em>No significant silences detected</em>';
              }
            }
            
            tempContext.close();
            
          } catch (error) {
            console.error('Error detecting silences:', error);
            alert(`Error detecting silences: ${error.message}`);
          }
        }

        // Add region creation on double-click
        wavesurfer1.on('dblclick', (e) => {
          const time = wavesurfer1.getCurrentTime();
          if (selectedRegion1) {
            audio1Regions.removeRegion(selectedRegion1);
          }
          createRegion(wavesurfer1, 'rgba(255, 0, 0, 0.3)', 'region1', audio1Regions);
          selectedRegion1.start = Math.max(0, time - 5);
          selectedRegion1.end = Math.min(wavesurfer1.getDuration(), time + 5);
          updateRegionInfo('region1', selectedRegion1.start, selectedRegion1.end);
        });

        wavesurfer2.on('dblclick', (e) => {
          const time = wavesurfer2.getCurrentTime();
          if (selectedRegion2) {
            audio1Regions.removeRegion(selectedRegion2);
          }
          createRegion(wavesurfer2, 'rgba(255, 0, 0, 0.3)', 'region2', audio1Regions);
          selectedRegion2.start = Math.max(0, time - 5);
          selectedRegion2.end = Math.min(wavesurfer2.getDuration(), time + 5);
          updateRegionInfo('region2', selectedRegion2.start, selectedRegion2.end);
        });

        // Add region update listeners
        wavesurfer1.on('region-updated', (region) => {
          if (region.id === 'region1') {
            updateRegionInfo('region1', region.start, region.end);
          }
        });

        wavesurfer2.on('region-updated', (region) => {
          if (region.id === 'region2') {
            updateRegionInfo('region2', region.start, region.end);
          }
        });

        // Add region click listeners for selection
        wavesurfer1.on('region-clicked', (region) => {
          if (selectedRegion1 && selectedRegion1 !== region) {
            selectedRegion1.color = 'rgba(255, 0, 0, 0.3)';
          }
          region.color = 'rgba(255, 255, 0, 0.5)';
          selectedRegion1 = region;
        });

        wavesurfer2.on('region-clicked', (region) => {
          if (selectedRegion2 && selectedRegion2 !== region) {
            selectedRegion2.color = 'rgba(255, 0, 0, 0.3)';
          }
          region.color = 'rgba(255, 255, 0, 0.5)';
          selectedRegion2 = region;
        });

/*
        wavesurfer1.registerPlugin(
          Spectrogram.create({
            labels: true,
            height: 100,
            splitChannels: true,
            scale: 'linear', // or 'linear'
            frequencyMax: 8000,
            frequencyMin: 0,
            fftSamples: 1024,
            labelsBackground: 'rgba(0, 0, 0, 0.1)',
          }),
        )
        wavesurfer2.registerPlugin(
          Spectrogram.create({
            labels: true,
            height: 100,
            splitChannels: true,
            scale: 'mel', // or 'linear'
            frequencyMax: 8000,
            frequencyMin: 0,
            fftSamples: 1024,
            labelsBackground: 'rgba(0, 0, 0, 0.1)',
          }),
        )*/

        // Zoom Control
        document.getElementById('zoom').addEventListener('input', (e) => {
          const zoomLevel = Number(e.target.value);
          wavesurfer1.zoom(zoomLevel);
          wavesurfer2.zoom(zoomLevel);
        });

        // Audio properties extraction
        async function extractAudioProperties(file, statsId) {
          const audioContext = new AudioContext();
          const arrayBuffer = await file.arrayBuffer();
          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

          const duration = audioBuffer.duration.toFixed(2) + ' seconds';
          const sampleRate = audioBuffer.sampleRate + ' Hz';
          const channels = audioBuffer.numberOfChannels;
          const fileName = file.name;

          let encoding = 'Unknown'; // Encoding detection placeholder

          // Display stats
          document.getElementById(statsId).innerHTML = `
                    <h3>File Information</h3>
                    Name: ${fileName}</br>
                    Duration: ${duration}<br>
                    Sample Rate: ${sampleRate}<br>
                    Channels: ${channels}<br>
                    Encoding: ${encoding}
                `;
        }

        // Function to load audio from URL
        async function loadAudioFromURL(waveInstance, url, statsId) {
          try {
            // Show loading state
            document.getElementById(statsId).innerHTML = '<p>Loading audio from URL...</p>';
            
            // Load the audio directly from URL
            await waveInstance.load(url);
            
            // Extract properties from the loaded audio
            const audioElement = waveInstance.media;
            if (audioElement) {
              const duration = audioElement.duration ? audioElement.duration.toFixed(2) + ' seconds' : 'Unknown';
              const fileName = url.split('/').pop() || 'Audio from URL';
              
              document.getElementById(statsId).innerHTML = `
                <h3>File Information</h3>
                Name: ${fileName}</br>
                Duration: ${duration}<br>
                Source: URL<br>
                URL: ${url}
              `;
            }
          } catch (error) {
            console.error('Error loading audio from URL:', error);
            document.getElementById(statsId).innerHTML = `<p style="color: red;">Error loading audio: ${error.message}</p>`;
          }
        }

        const drop1 = document.getElementById('drop1')
        const drop2 = document.getElementById('drop2')

        registerDropzone(drop1, 1);
        registerDropzone(drop2, 2);

        // Load audio file
        function loadAudio(waveInstance, file, statsId) {
          const url = URL.createObjectURL(file);
          waveInstance.loadAudio(url);
          //waveInstance.media.src = url;

          // Wait for the audio to be ready before extracting properties
          waveInstance.on('ready', () => {
            extractAudioProperties(file, statsId);
          });
        }

        // Handle file changes
        document.getElementById('audio1').addEventListener('change', (e) => {
          loadAudio(wavesurfer1, e.target.files[0], 'stats1');
        });

        document.getElementById('audio2').addEventListener('change', (e) => {
          loadAudio(wavesurfer2, e.target.files[0], 'stats2');
        });

        // Handle URL input changes
        document.getElementById('url1').addEventListener('change', (e) => {
          const url = e.target.value.trim();
          if (url) {
            loadAudioFromURL(wavesurfer1, url, 'stats1');
          }
        });

        document.getElementById('url2').addEventListener('change', (e) => {
          const url = e.target.value.trim();
          if (url) {
            loadAudioFromURL(wavesurfer2, url, 'stats2');
          }
        });

        // Add Enter key support for URL inputs
        document.getElementById('url1').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            const url = e.target.value.trim();
            if (url) {
              loadAudioFromURL(wavesurfer1, url, 'stats1');
            }
          }
        });

        document.getElementById('url2').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            const url = e.target.value.trim();
            if (url) {
              loadAudioFromURL(wavesurfer2, url, 'stats2');
            }
          }
        });

        const playPause = (wavesurfer, audioNumber) => {
          if (wavesurfer.media.readyState >= 2) {
            wavesurfer.playPause();
          } else {
            console.log(`Audio ${audioNumber} is not ready yet.`);
          }
        }

        // Function to play selected region
        function playSelectedRegion(audioNumber) {
          if (audioNumber === 1) {
            playRegion(wavesurfer1, selectedRegion1, 'region1');
          } else {
            playRegion(wavesurfer2, selectedRegion2, 'region2');
          }
        }

        // Play buttons for each audio file
        document.getElementById('play1').addEventListener('click', () => {
          playPause(wavesurfer1, 1);
        });

        document.getElementById('play2').addEventListener('click', () => {
          playPause(wavesurfer2, 2);
        });

        // Play both audios simultaneously
        document.getElementById('playBoth').addEventListener('click', () => {
          playPause(wavesurfer1, 1);
            playPause(wavesurfer2, 2);
        });

        // Region control buttons
        document.getElementById('playRegion1').addEventListener('click', () => {
          playSelectedRegion(1);
        });

        document.getElementById('playRegion2').addEventListener('click', () => {
          playSelectedRegion(2);
        });

        document.getElementById('clearRegion1').addEventListener('click', () => {
          clearRegion(wavesurfer1, 'region1');
        });

        document.getElementById('clearRegion2').addEventListener('click', () => {
          clearRegion(wavesurfer2, 'region2');
        });

        // Silence detection buttons
        document.getElementById('detectSilence1').addEventListener('click', () => {
          detectSilences(wavesurfer1, audio1Regions, 1);
        });

        document.getElementById('detectSilence2').addEventListener('click', () => {
          detectSilences(wavesurfer2, audio2Regions, 2);
        });

        // Sensitivity control listeners
        document.getElementById('silenceThreshold1').addEventListener('input', (e) => {
          document.getElementById('thresholdValue1').textContent = e.target.value;
        });

        document.getElementById('minSilenceDuration1').addEventListener('input', (e) => {
          document.getElementById('durationValue1').textContent = e.target.value;
        });

        document.getElementById('silenceThreshold2').addEventListener('input', (e) => {
          document.getElementById('thresholdValue2').textContent = e.target.value;
        });

        document.getElementById('minSilenceDuration2').addEventListener('input', (e) => {
          document.getElementById('durationValue2').textContent = e.target.value;
        });
      });
    </script>

    <style>
        .drop-zone {
            border: 2px dashed #007bff;
            padding: 20px;
            margin: 20px;
            cursor: pointer;
            background-color: #e9f5ff;
            border-radius: 10px;
            transition: background-color 0.3s;
        }
        .drop-zone.highlight {
            background-color: #6cf65c;
            border-color: #327f29;
        }
        .time-display {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        
        /* Custom range input styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-track {
            background: #e5e7eb;
            height: 6px;
            border-radius: 3px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: #8b5cf6;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-track {
            background: #e5e7eb;
            height: 6px;
            border-radius: 3px;
        }
        
        input[type="range"]::-moz-range-thumb {
            background: #8b5cf6;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen">
<div class="container mx-auto py-10">
    <h1 class="text-3xl font-bold text-center mb-8">Audio Comparison Tool</h1>
    <p class="text-center mb-8 text-gray-700">Upload or link two audio files to compare their waveforms, and stats.</p>

    <!-- Two Column Design -->
    <div class="grid grid-cols-2 gap-8">
        <!-- Audio File 1 -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Audio File 1</h2>
            <div class="border-2 border-dashed border-blue-500 rounded-lg p-6 text-center cursor-pointer drop-zone"
                 id="drop1">
                <p class="text-gray-700 mb-2">Drop file here or click to upload</p>
                <input type="file" id="audio1" accept="audio/*" class="hidden">
            </div>
            <p class="my-4 text-center text-gray-500">Or provide a URL:</p>
            <input type="url" id="url1" placeholder="Enter audio URL and press Enter"
                   class="w-full border border-gray-300 rounded-lg p-2">
            <div id="info1" class="mt-4 text-sm text-gray-700"></div>
        </div>

        <!-- Audio File 2 -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Audio File 2</h2>
            <div class="border-2 border-dashed border-green-500 rounded-lg p-6 text-center cursor-pointer drop-zone"
                 id="drop2">
                <p class="text-gray-700 mb-2">Drop file here or click to upload</p>
                <input type="file" id="audio2" accept="audio/*" class="hidden">
            </div>
            <p class="my-4 text-center text-gray-500">Or provide a URL:</p>
            <input type="url" id="url2" placeholder="Enter audio URL and press Enter"
                   class="w-full border border-gray-300 rounded-lg p-2">
            <div id="info2" class="mt-4 text-sm text-gray-700"></div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="mt-8 grid grid-cols-2 gap-8">
        <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
            <h3 class="text-lg font-semibold mb-2">Audio File 1 Stats</h3>
            <div id="stats1" class="text-sm text-gray-700">No data loaded</div>
            <div class="mt-3 pt-3 border-t border-gray-300">
                <h4 class="font-medium text-gray-600 mb-2">Region Selection</h4>
                <div id="region1Info" class="text-sm text-gray-700 mb-2"><em>No region selected</em></div>
                <div class="flex gap-2 mb-3">
                    <button id="playRegion1" class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">Play Region</button>
                    <button id="clearRegion1" class="px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700">Clear Region</button>
                </div>
                <div class="pt-2 border-t border-gray-200">
                    <h5 class="font-medium text-gray-600 mb-2">Silence Detection</h5>
                    <div class="mb-2">
                        <label class="text-xs text-gray-600">Threshold: <span id="thresholdValue1">1</span>%</label>
                        <input type="range" id="silenceThreshold1" min="1" max="20" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="mb-2">
                        <label class="text-xs text-gray-600">Min Duration: <span id="durationValue1">0.1</span>s</label>
                        <input type="range" id="minSilenceDuration1" min="0.05" max="1.0" step="0.05" value="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <button id="detectSilence1" class="px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700 mb-2">Detect Silences</button>
                    <div id="silenceInfo1" class="text-sm text-gray-700"><em>Click to detect silences</em></div>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg shadow-inner">
            <h3 class="text-lg font-semibold mb-2">Audio File 2 Stats</h3>
            <div id="stats2" class="text-sm text-gray-700">No data loaded</div>
            <div class="mt-3 pt-3 border-t border-gray-300">
                <h4 class="font-medium text-gray-600 mb-2">Region Selection</h4>
                <div id="region2Info" class="text-sm text-gray-700 mb-2"><em>No region selected</em></div>
                <div class="flex gap-2 mb-3">
                    <button id="playRegion2" class="px-3 py-1 bg-green-600 text-white text-xs rounded hover:bg-green-700">Play Region</button>
                    <button id="clearRegion2" class="px-3 py-1 bg-red-600 text-white text-xs rounded hover:bg-red-700">Clear Region</button>
                </div>
                <div class="pt-2 border-t border-gray-200">
                    <h5 class="font-medium text-gray-600 mb-2">Silence Detection</h5>
                    <div class="mb-2">
                        <label class="text-xs text-gray-600">Threshold: <span id="thresholdValue2">1</span>%</label>
                        <input type="range" id="silenceThreshold2" min="1" max="20" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="mb-2">
                        <label class="text-xs text-gray-600">Min Duration: <span id="durationValue2">0.1</span>s</label>
                        <input type="range" id="minSilenceDuration2" min="0.05" max="1.0" step="0.05" value="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <button id="detectSilence2" class="px-3 py-1 bg-purple-600 text-white text-xs rounded hover:bg-purple-700 mb-2">Detect Silences</button>
                    <div id="silenceInfo2" class="text-sm text-gray-700"><em>Click to detect silences</em></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Waveform Section -->
    <div class="mt-10">
        <h3 class="text-xl font-semibold text-center mb-6">Waveforms</h3>
        
        <!-- Region Selection Instructions -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
            <h4 class="font-semibold text-blue-800 mb-2">🎯 Region Selection Instructions:</h4>
            <ul class="text-sm text-blue-700 space-y-1">
                <li>• <strong>Double-click</strong> anywhere on a waveform to create a region (10-second default)</li>
                <li>• <strong>Drag</strong> the region edges to resize</li>
                <li>• <strong>Drag</strong> the region to move it</li>
                <li>• <strong>Click</strong> a region to select it (highlighted in yellow)</li>
                <li>• Use the <strong>Play Region</strong> button to play only the selected portion</li>
            </ul>
        </div>
        
        <div class="grid grid-cols-1 gap-6">
            <div class="relative">
                <div id="waveform1" class="w-full h-32 bg-gray-200 rounded-lg"></div>
                <div id="time1" class="time-display">0s 0ms</div>
            </div>
            <div class="relative">
                <div id="waveform2" class="w-full h-32 bg-gray-200 rounded-lg"></div>
                <div id="time2" class="time-display">0s 0ms</div>
            </div>
        </div>

        <!-- Zoom Control -->
        <div class="mt-6 text-center">
            <label for="zoom" class="mr-4">Zoom:</label>
            <input id="zoom" type="range" min="10" max="500" value="100" class="w-1/2" step="5">
        </div>

        <!-- Play Controls -->
        <div class="mt-6 text-center">
            <button id="play1" class="px-4 py-2 bg-blue-500 text-white rounded-lg">Play First</button>
            <button id="play2" class="px-4 py-2 bg-green-500 text-white rounded-lg">Play Second</button>
            <button id="playBoth" class="px-4 py-2 bg-purple-500 text-white rounded-lg">Play Both</button>
        </div>
    </div>
</div>
</body>
</html>
